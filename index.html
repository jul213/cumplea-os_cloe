<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Para Cloe üéÇ</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Caveat:wght@700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    /* ========================================
       VARIABLES & RESET
       ======================================== */
    :root {
      --verde:       #00c07f;
      --rosa:        #ff6b9d;
      --fondo:       #0d0d0d;
      --fondo2:      #161616;
      --burbuja-bot: #1e1e1e;
      --burbuja-yo:  #1a3a2a;
      --texto:       #f0f0f0;
      --texto-dim:   #777;
      --borde:       #2a2a2a;
      --radius:      18px;
    }

    *, *::before, *::after {
      box-sizing: border-box; margin: 0; padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    /* Prevent iOS bounce & zoom on input focus */
    html { height: 100%; overflow: hidden; }
    body {
      height: 100%; width: 100%;
      font-family: 'DM Sans', sans-serif;
      background: var(--fondo);
      color: var(--texto);
      overflow: hidden;
      position: fixed;
      /* Prevent text resize on orientation change */
      -webkit-text-size-adjust: 100%;
    }

    /* ========================================
       LAYOUT ‚Äî usa dvh para m√≥viles con barra de nav
       ======================================== */
    #app {
      display: flex;
      flex-direction: column;
      height: 100dvh;
      max-width: 700px;
      margin: 0 auto;
    }

    /* ========================================
       CABECERA
       ======================================== */
    .cabecera {
      background: var(--fondo2);
      border-bottom: 1px solid var(--borde);
      /* safe-area para el notch */
      padding: calc(12px + env(safe-area-inset-top)) 16px 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
      z-index: 10;
    }
    .avatar {
      width: 42px; height: 42px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--verde), var(--rosa));
      display: flex; align-items: center; justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }
    /* Punto verde pulsante de "en l√≠nea" */
    .avatar-wrap { position: relative; flex-shrink: 0; }
    .online-dot {
      position: absolute; bottom: 1px; right: 1px;
      width: 11px; height: 11px;
      background: var(--verde);
      border-radius: 50%;
      border: 2px solid var(--fondo2);
      animation: pulse-dot 2s ease-in-out infinite;
    }
    @keyframes pulse-dot {
      0%,100% { transform: scale(1); opacity: 1; }
      50%      { transform: scale(1.3); opacity: 0.7; }
    }
    .cabecera-info h1 { font-size: 0.95rem; font-weight: 700; line-height: 1.2; }
    .cabecera-info p  { font-size: 0.7rem; color: var(--verde); }

    /* ========================================
       √ÅREA DE CHAT ‚Äî flex:1 para llenar espacio
       ======================================== */
    #contenedor-chat {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 14px 12px 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      scroll-behavior: smooth;
      /* Momentum scroll en iOS */
      -webkit-overflow-scrolling: touch;
    }
    #contenedor-chat::-webkit-scrollbar { display: none; }

    /* Burbujas */
    .mensaje {
      max-width: 80%;
      padding: 9px 13px;
      border-radius: var(--radius);
      font-size: 0.88rem;
      line-height: 1.55;
      /* Fade + pop suave */
      opacity: 0;
      animation: fadeUp 0.25s cubic-bezier(0.34,1.4,0.64,1) forwards;
      word-break: break-word;
    }
    .bot {
      align-self: flex-start;
      background: var(--burbuja-bot);
      border-top-left-radius: 4px;
      border: 1px solid var(--borde);
    }
    .usuario {
      align-self: flex-end;
      background: var(--burbuja-yo);
      border-top-right-radius: 4px;
      border: 1px solid #1e4a30;
    }
    .hora {
      font-size: 0.6rem;
      color: var(--texto-dim);
      margin-top: 5px;
      display: block;
      text-align: right;
    }
    .foto-recuerdo {
      width: 100%; max-width: 260px;
      border-radius: 12px; margin-top: 8px;
      border: 2px solid var(--borde); display: block;
    }

    /* ========================================
       INDICADOR ESCRIBIENDO ‚Äî tres puntos animados
       ======================================== */
    #escribiendo {
      padding: 0 14px 4px;
      min-height: 20px;
      display: flex;
      align-items: center;
      gap: 5px;
      flex-shrink: 0;
    }
    .dot-writing {
      display: none;
      gap: 4px;
      align-items: center;
      font-size: 0.7rem;
      color: var(--texto-dim);
      font-style: italic;
    }
    .dot-writing.visible { display: flex; }
    .dot-writing span {
      width: 5px; height: 5px;
      background: var(--texto-dim);
      border-radius: 50%;
      animation: bounce-dot 1.2s ease-in-out infinite;
    }
    .dot-writing span:nth-child(2) { animation-delay: 0.2s; }
    .dot-writing span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes bounce-dot {
      0%,80%,100% { transform: translateY(0); opacity: 0.4; }
      40%          { transform: translateY(-5px); opacity: 1; }
    }

    /* ========================================
       PANEL DE CHIPS ‚Äî scroll horizontal en m√≥vil
       ======================================== */
    #panel-comandos {
      background: var(--fondo2);
      border-top: 1px solid var(--borde);
      padding: 8px 12px;
      display: flex;
      flex-direction: row;
      gap: 6px;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      flex-shrink: 0;
      /* Degradado derecho para sugerir scroll */
      -webkit-mask-image: linear-gradient(to right, black 85%, transparent 100%);
      mask-image: linear-gradient(to right, black 85%, transparent 100%);
    }
    #panel-comandos::-webkit-scrollbar { display: none; }
    .chip {
      background: #1e1e1e;
      border: 1px solid #333;
      color: var(--verde);
      font-size: 0.72rem;
      font-weight: 600;
      padding: 6px 13px;
      border-radius: 999px;
      cursor: pointer;
      white-space: nowrap;
      flex-shrink: 0;
      transition: background 0.15s, transform 0.1s, border-color 0.15s;
      user-select: none;
      /* Touch target m√≠nimo 44px */
      min-height: 32px;
      display: flex;
      align-items: center;
    }
    .chip:active { transform: scale(0.93); background: #282828; }
    .chip.locked { color: #555; border-color: #252525; }
    .chip.locked::before { content: 'üîí '; }

    /* ========================================
       √ÅREA DE ENTRADA
       ======================================== */
    .area-entrada {
      background: var(--fondo2);
      border-top: 1px solid var(--borde);
      padding: 8px 12px calc(10px + env(safe-area-inset-bottom));
      display: flex;
      gap: 8px;
      align-items: center;
      flex-shrink: 0;
    }
    .input-wrapper {
      flex: 1;
      background: #1e1e1e;
      border: 1.5px solid var(--borde);
      border-radius: 999px;
      padding: 0 16px;
      height: 44px;
      display: flex;
      align-items: center;
      transition: border-color 0.2s;
    }
    .input-wrapper:focus-within { border-color: var(--verde); }
    input {
      width: 100%; border: none; outline: none;
      background: transparent;
      /* 16px m√≠nimo para evitar zoom en iOS */
      font-size: 16px;
      font-family: 'DM Sans', sans-serif;
      color: var(--texto);
    }
    input::placeholder { color: var(--texto-dim); font-size: 0.85rem; }
    .btn-enviar {
      background: var(--verde);
      color: #000;
      border: none;
      /* Touch target 44x44 */
      width: 44px; height: 44px;
      border-radius: 50%;
      font-size: 17px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
      flex-shrink: 0;
    }
    .btn-enviar:active { transform: scale(0.9); background: #00e094; }

    /* ========================================
       PANTALLA FINAL
       ======================================== */
    #pantalla-final {
      display: none;
      position: fixed; inset: 0;
      background: #000;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 24px 24px calc(24px + env(safe-area-inset-bottom));
      text-align: center;
    }
    .titulo-rgb {
      font-family: 'Caveat', cursive;
      font-size: clamp(3.2rem, 16vw, 7rem);
      font-weight: 700;
      line-height: 1;
      background: linear-gradient(90deg, #ff6b9d, #ffd166, #00c07f, #6bcbff, #ff6b9d);
      background-size: 300%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rgb-move 4s linear infinite;
    }
    @keyframes rgb-move { from { background-position: 0%; } to { background-position: 300%; } }
    .subtitulo-final { color: #888; margin-top: 12px; font-size: 0.85rem; letter-spacing: 5px; text-transform: uppercase; }

    /* Bot√≥n WS con pulso para llamar la atenci√≥n */
    .btn-ws {
      margin-top: 30px;
      padding: 15px 30px;
      background: var(--verde);
      color: #000;
      text-decoration: none;
      border-radius: 999px;
      font-weight: 700;
      font-size: 0.95rem;
      display: none;
      animation: pulse-ws 1.8s ease-in-out infinite;
      /* Touch target */
      min-height: 50px;
      align-items: center;
    }
    @keyframes pulse-ws {
      0%,100% { box-shadow: 0 0 0 0 rgba(0,192,127,0.5); }
      50%      { box-shadow: 0 0 0 14px rgba(0,192,127,0); }
    }
    .btn-ws:active { opacity: 0.85; }
    .firma { color: #2a2a2a; font-size: 0.7rem; margin-top: 40px; }

    /* ========================================
       ANIMACIONES PRINCIPALES
       ======================================== */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(8px) scale(0.97); }
      to   { opacity: 1; transform: translateY(0)  scale(1); }
    }
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      25%      { transform: translateX(-5px); }
      75%      { transform: translateX(5px); }
    }
    .shake { animation: shake 0.3s ease-in-out; }

    /* ========================================
       CONTADOR (dentro de burbuja de chat)
       ======================================== */
    #contador-banner { display: none; } /* ya no se usa como banner */
    .contador-label { font-size: 0.65rem; color: #777; margin-top: 2px; }
    .contador-valor {
      font-size: 1.15rem; font-weight: 700; color: var(--verde);
      font-variant-numeric: tabular-nums;
      line-height: 1.1;
    }
    .contador-bloque { text-align: center; }
    .contador-sep { color: #444; font-size: 1.2rem; margin-bottom: 10px; }
  </style>
</head>
<body>

<!-- =============================================
     INTERFAZ PRINCIPAL DE CHAT
     ============================================= -->
<div id="app">

  <!-- CABECERA -->
  <div class="cabecera">
    <div class="avatar">üéÇ</div>
    <div class="cabecera-info">
      <h1>Julio (Bot)</h1>
      <p>en l√≠nea ahora ‚ú®</p>
    </div>
  </div>

  <!-- MENSAJES -->
  <div id="contenedor-chat"></div>
  <div id="escribiendo">
    <div class="dot-writing" id="dots">
      <span></span><span></span><span></span>
      <span style="margin-left:4px;font-size:0.7rem;color:#666">Julio est√° escribiendo</span>
    </div>
  </div>

  <!-- CONTADOR DE CUMPLEA√ëOS -->
  <div id="contador-banner" style="display:none"></div>

  <!-- CHIPS DE COMANDOS (siempre visibles) -->
  <div id="panel-comandos">
    <!-- Los chips se renderizan din√°micamente seg√∫n el estado del juego -->
  </div>

  <!-- INPUT -->
  <div class="area-entrada">
    <div class="input-wrapper">
      <input type="text" id="entradaUsuario" placeholder="Escribe un comando o mensaje‚Ä¶" autocomplete="off">
    </div>
    <button class="btn-enviar" onclick="gestionarEntrada()" aria-label="Enviar">‚û§</button>
  </div>

</div>

<!-- =============================================
     PANTALLA FINAL (confetti + regalo)
     ============================================= -->
<div id="pantalla-final">
  <div class="titulo-rgb">¬°FELIZ<br>CUMPLE<br>CLOE!</div>
  <p class="subtitulo-final">‚ú® 17 A√ëOS ‚ú®</p>
  <a href="#" id="link-ws" class="btn-ws">¬°P√≠deme tu regalo por WhatsApp! üéÅ</a>
  <p class="firma">Hecho con dedicacion por Julio</p>
</div>


<script>
  /* ============================================
     CONFIGURACI√ìN ‚Äî EDITA SOLO ESTA SECCI√ìN
     ============================================ */
  const CONFIG = {
    telefonoJulio:  "34614147077",   // Tu n√∫mero de WhatsApp (sin +)
    fotoRecuerdo:   "recuerdo.jpg",  // Nombre de la imagen que subes junto al HTML
  };

  /* ============================================
     CONTENIDO ‚Äî PERSONALIZA A TU GUSTO
     ============================================ */

  // Chistes aleatorios (a√±ade o quita los que quieras)
  const CHISTES = [
    "¬øQu√© le dice un jaguar a otro jaguar? <br><b>‚Äî Jaguar you!</b> üòÇ",
    "¬øPor qu√© los p√°jaros no usan Facebook? <br><b>‚Äî Porque ya tienen Twitter (X). üê¶</b>",
    "¬øC√≥mo se dice 'pa√±uelo' en japon√©s? <br><b>‚Äî Saka-moko. ü§ß</b>",
    "¬øQu√© hace una abeja en el gimnasio? <br><b>‚Äî ¬°Zumba! üêù</b>",
    "¬øC√≥mo se queda un mago despu√©s de comer? <br><b>‚Äî Magordito. üé©</b>",
    "¬øQu√© le dice el mar a la playa? <br><b>‚Äî Nada, la saluda y se va. üåä</b>",
  ];

  // Frases personalizadas para Cloe ‚Äî directas, sin cursiler√≠a
  const FRASES = [
    "Mejor compa√±era de rutas: t√∫. üèîÔ∏è",
    "17 a√±os y sin perder el ritmo. Hay que mantenerlo. ‚ú®",
    "Hoy no se aceptan quejas. üéÇ",
    "Cullera fue un 10. Ya toca organizar la siguiente. üåä",
    "Un a√±o m√°s que te debo una buena ruta. Lo apunto. üóìÔ∏è",
    "hoy manda Cloe.",
  ];

  // Palabras de √°nimo aleatorias (cuando acierte algo)
  const APLAUSOS = ["¬°Exacto! üéØ", "¬°Correcto! üí™", "¬°Eso es! üåü", "¬°Muy bien! üî•", "¬°Sin dudar! üí´"];

  // Peque√±os mensajes de error (cuando falle algo)
  const ERRORES = [
    "¬°Casi! Prueba otra vez. üòÖ",
    "Hmm... no del todo. ü§î",
    "Error 404: respuesta incorrecta. üòÇ",
    "Est√° mal, pero tu puedes",
  ];

  /* ============================================
     ESTADO GLOBAL
     ============================================ */
  const chat       = document.getElementById('contenedor-chat');
  const entrada    = document.getElementById('entradaUsuario');
  const indicador  = document.getElementById('escribiendo');
  const panelChips = document.getElementById('panel-comandos');

  let paso           = "LIBRE";   // Estado actual del flujo de conversaci√≥n
  let juegoCompletado = false;    // ¬øHa superado el quiz?

  /* ============================================
     ARRANQUE: mensajes de bienvenida
     ============================================ */
  window.onload = () => {
    renderChips();    // Dibujar chips iniciales

    botDelayed("¬°Hola Cloe! ü•≥ Bienvenida a tu chat especial.", 500);
    botDelayed("He bloqueado <b>/foto</b> y <b>/regalo</b> con un candado. üîí", 2200);
    botDelayed("Para desbloquearlos tienes que superar el reto: escribe <b>/jugar</b>.", 4200);
    botDelayed("Mira los botones de abajo para ver todo lo que puedes hacer. Hay alguno que‚Ä¶ mejor lo descubres t√∫. üëÄ", 6400);
  };

  /* ============================================
     GESTI√ìN DE ENTRADA DEL USUARIO
     ============================================ */
  function gestionarEntrada() {
    const t = entrada.value.trim();
    if (!t) return;
    enviarUsuario(t);
    entrada.value = "";
    procesarLogica(t.toLowerCase());
  }

  // Enviar tambi√©n con la tecla Enter
  entrada.addEventListener("keypress", (e) => { if (e.key === "Enter") gestionarEntrada(); });

  // Enviar al hacer clic en un chip
  function enviarComando(cmd) {
    enviarUsuario(cmd);
    procesarLogica(cmd.toLowerCase());
  }

  /* ============================================
     L√ìGICA PRINCIPAL DE COMANDOS
     ============================================ */
  function procesarLogica(cmd) {
    // Mostramos "escribiendo..." mientras el bot "piensa"
    document.getElementById('dots').classList.add('visible');

    setTimeout(() => {
      document.getElementById('dots').classList.remove('visible');

      /* --- COMANDOS SIEMPRE DISPONIBLES --- */

      // /chiste ‚Üí chiste aleatorio
      if (cmd === "/chiste") {
        enviarBot(aleatorio(CHISTES));
        return;
      }

      // /frase ‚Üí frase motivacional aleatoria
      if (cmd === "/frase") {
        enviarBot(aleatorio(FRASES));
        return;
      }

      // /canto ‚Üí bot "canta" la canci√≥n de cumplea√±os l√≠nea a l√≠nea
      if (cmd === "/canto") {
        const versos = [
          "üé§ Venga, que all√° voy‚Ä¶",
          "üéµ <i>Cumplea√±os feliz‚Ä¶</i>",
          "üéµ <i>Cumplea√±os feliz‚Ä¶</i>",
          "üéµ <i>Te deseamos todos‚Ä¶</i>",
          "üéµ <i>¬°Cumplea√±os feliz, Cloe!</i> üéÇ",
          "‚Ä¶",
          "Vale, reconozco que no tengo voz. üò¨<br>Pero el intento cuenta, ¬øno? üé§",
        ];
        versos.forEach((v, i) => {
          setTimeout(() => enviarBot(v), 300 + i * 1100);
        });
        return;
      }

      // /sorpresa ‚Üí mensaje oculto especial
      if (cmd === "/sorpresa") {
        enviarBot("Aqu√≠ va un frase: eres una gran amiga Cloe. gracias por hacer que conociera las rutas, seguro que te ira muy bien este nuevo a√±o. se que a veces es muy estresante todo pero tu puedes üê∫‚ú®");
        return;
      }

      // /stickers ‚Üí stickers reales con im√°genes (no se pueden robar üòÇ)
      if (cmd === "/stickers") {
        enviarBot("Mira mis stickers‚Ä¶ bonitos, bueno en realidad no mucho. Pero estos no te los puedo dar, Son m√≠os.");
        // Stickers: mezcla de perros, gatos y lobos kawaii
        // Stickers: fotos reales tiernas de animales (no kawaii exagerado)
        const stickers = [
          { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/YellowLabradorLooking_new.jpg/320px-YellowLabradorLooking_new.jpg", label: "Labrador üê∂" },
          { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4d/Cat_November_2010-1a.jpg/320px-Cat_November_2010-1a.jpg", label: "Gatete üê±" },
          { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/Dog_Breeds.jpg/320px-Dog_Breeds.jpg", label: "Perrito üêï" },
          { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Kittyply_edit1.jpg/320px-Kittyply_edit1.jpg", label: "Minino üêæ" },
          { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/Camponotus_flavomarginatus_ant.jpg/320px-Camponotus_flavomarginatus_ant.jpg", label: "Sorpresa üòÇ" },
          { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/WelshCorgi.jpg/320px-WelshCorgi.jpg", label: "Corgi üê∂" },
        ];
        setTimeout(() => {
          const html = `
            <div style="margin-bottom:6px;font-size:0.8rem;color:#aaa">‚Äî Mis stickers (solo para ver) ‚Äî</div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-width:260px">
              ${stickers.map(s => `
                <div style="background:#1a1a1a;border:1px solid #333;border-radius:14px;padding:8px;text-align:center;cursor:default" title="No puedes robar estos cloe, intente buscar imagenes pero no quedaban tan bien">
                  <img src="${s.url}" style="width:60px;height:60px;object-fit:contain;display:block;margin:0 auto"
                    onerror="this.style.display='none';this.nextElementSibling.style.display='block'">
                  <div style="display:none;font-size:2rem">${s.label.split(' ')[1]||'üêæ'}</div>
                  <div style="font-size:0.6rem;color:#666;margin-top:4px">${s.label}</div>
                </div>`).join('')}
            </div>`;
          enviarBot(html);
          setTimeout(() => enviarBot("¬øA que quieres uno? no puedes. üòÇüîí<br><small style='color:#666'>‚Äî enviados desde la b√≥veda de Julio</small>"), 1200);
        }, 700);
        return;
      }

      // /bolos ‚Üí reto amistoso a bolos
      if (cmd === "/bolos") {
        const mensajes = [
          "¬øBolos? üëÄ",
          "Mira, te voy a ser sincero‚Ä¶",
          "La √∫ltima vez julio no derribo ninguno. üé≥",
          "¬øPero crees de verdad que eso cambia algo?",
          "soy imparcial, pero si tuviera que elegir creo que sera una victoria para ti.",
          "tu puedes ganar Cloe. tienes mi confianza üé≥üî•",
        ];
        mensajes.forEach((m, i) => {
          setTimeout(() => enviarBot(m), 300 + i * 1000);
        });
        return;
      }

      // Respuesta a "gracias" o "quiero"
      if (cmd.includes("gracias") || cmd.includes("quiero")) {
        enviarBot("¬°Para eso estoy programado! A disfrutar. üòä‚ú®");
        return;
      }

      /* --- COMANDO /jugar ‚Üí inicia el quiz --- */
      if (cmd === "/jugar") {
        if (juegoCompletado) {
          enviarBot("Ya superaste el reto, campeona. üèÜ Usa <b>/foto</b> y <b>/regalo</b> libremente.");
          return;
        }
        paso = "Q1";
        enviarBot("üéÆ ¬°Vamos all√°! Son solo 4 preguntas. <br><br><b>Pregunta 1:</b> ¬øCu√°ntos a√±os cumples hoy? üéÇ");
        renderChips();
        return;
      }

      /* --- FLUJO DEL QUIZ --- */
      if (paso === "Q1") {
        if (cmd.includes("17")) {
          paso = "Q2";
          enviarBot(`${aleatorio(APLAUSOS)} <br><br><b>Pregunta 2:</b> ¬øCu√°l es tu animal favorito? (Pista: üê∫)`);
        } else {
          errorBot(aleatorio(ERRORES));
        }
        return;
      }

      if (paso === "Q2") {
        if (cmd.includes("lobo")) {
          paso = "Q3";
          enviarBot(`${aleatorio(APLAUSOS)} <br><br><b>Pregunta 3:</b> ¬øD√≥nde fue nuestra √∫ltima ruta juntos? (Pista: üåä)`);
        } else {
          errorBot("Pista extra: empieza por L y hace ¬°auuu! üê∫");
        }
        return;
      }

      if (paso === "Q3") {
        if (cmd.includes("cullera")) {
          paso = "Q4";
          enviarBot(`${aleatorio(APLAUSOS)} <br><br><b>√öltima pregunta:</b> ¬øPrefieres üê∂ <b>perros</b> o üê± <b>gatos</b>?`);
        } else {
          errorBot("Casi‚Ä¶ piensa en playas y agua salada. üèñÔ∏è");
        }
        return;
      }

      if (paso === "Q4") {
        if (cmd.includes("perro")) {
          juegoCompletado = true;
          paso = "LIBRE";
          renderChips(); // Actualizar chips ‚Äî ya sin candado
          enviarBot("üéñÔ∏è ¬°RETO SUPERADO! Respuestas perfectas. <br>Ya puedes usar <b>/foto</b> y <b>/regalo</b>. ¬°A disfrutar! üéâ");
        } else {
          errorBot("Sabes perfectamente que los üê∂ son tus favoritos. üòÇ");
        }
        return;
      }

      /* --- COMANDOS DE PREMIO (requieren juego completado) --- */

      // /foto ‚Üí muestra la foto de Cullera
      if (cmd === "/foto") {
        if (juegoCompletado) {
          enviarBot("Buscando en el √°lbum‚Ä¶ üì∏");
          setTimeout(() => {
            enviarBot(
              `¬°Aqu√≠ est√°, nuestro momentazo en Cullera! ‚ú® <br>
               <img src="${CONFIG.fotoRecuerdo}" class="foto-recuerdo" 
                    alt="Recuerdo de Cullera" 
                    onerror="this.outerHTML='<p style=\'color:#888;font-size:0.8rem;\'>üì∑ (Sube el archivo recuerdo.jpg junto al HTML para ver la foto)</p>'">`
            );
          }, 1500);
        } else {
          errorBot("Bloqueado üîí ‚Äî Supera el reto con <b>/jugar</b> primero.");
        }
        return;
      }

      // /regalo ‚Üí pide un deseo para enviar por WhatsApp
      if (cmd === "/regalo") {
        if (juegoCompletado) {
          paso = "DESEO";
          enviarBot("üéÅ ¬øQu√© dulces te gustarian? se que te gustan unos especificos. pero no se cuales jajaja üç¨");
        } else {
          errorBot("¬°No tan r√°pido! üîí Completa el reto con <b>/jugar</b>.");
        }
        return;
      }

      /* --- ESTADO DESEO: recoge el capricho y lanza pantalla final --- */
      if (paso === "DESEO") {
        const link = `https://wa.me/${CONFIG.telefonoJulio}?text=${encodeURIComponent("¬°Hola Julio! Soy Cloe üéÇ y quiero: " + cmd)}`;
        document.getElementById('link-ws').href  = link;
        document.getElementById('link-ws').style.display = 'flex';
        enviarBot("üéâ ¬°Perfecto! Ahora mira la pantalla final‚Ä¶ te espero ah√≠.");
        setTimeout(mostrarPantallaFinal, 2800);
        return;
      }

      // /futuro ‚Üí contador bloqueado (regalo misterioso)
      if (cmd === "/futuro") {
        enviarBot("üîí <b>ACCESO DENEGADO</b>");
        setTimeout(() => enviarBot("Este comando forma parte de otro regalo. diculpa cloe no tengo acceso"), 900);
        setTimeout(() => enviarBot("No puedo darte m√°s informaci√≥n. ordenes de julio"), 1900);
        setTimeout(() => {
          enviarBot("Solo te puedo decir‚Ä¶ que el tiempo corre. ‚è≥");
          // Mostrar contador SOLO dentro del chat como burbuja
          setTimeout(() => enviarBot(generarContadorHTML()), 800);
        }, 3000);
        return;
      }

      // /misterio ‚Üí mensaje cr√≠ptico, no hay m√°s info
      if (cmd === "/misterio") {
        const frases = [
          "Eyyy‚Ä¶ esto es un misterio.",
          "Ni t√∫ ni yo sabemos qu√© hay aqu√≠.",
          "Lo siento, no puedo ayudarte con esto. ü§∑",
          "Algunos secretos son secretos por algo.",
          "üåë",
        ];
        frases.forEach((f, i) => setTimeout(() => enviarBot(f), 400 + i * 900));
        return;
      }

      // /cloe ‚Üí mensaje personalizado para ella
      if (cmd === "/cloe") {
        setTimeout(() => enviarBot("Cloe."), 300);
        setTimeout(() => enviarBot("Hace 17 a√±os apareci√≥ alguien que roba stickers, le gustan los deportes  y elige rutas muy buenas."), 1300);
        setTimeout(() => enviarBot("la mejor companera de rutas."), 2500);
        setTimeout(() => enviarBot("As√≠ que‚Ä¶ feliz cumplea√±os. üê∫"), 3600);
        setTimeout(() => enviarBot("<small style='color:#555'>‚Äî Julio (el del bot)</small>"), 4500);
        return;
      }

      /* --- FALLBACK: comando desconocido --- */
      enviarBot("No entiendo eso ü§î ‚Äî Usa uno de los botones de abajo o prueba:<br><b>/jugar</b>, <b>/chiste</b>, <b>/frase</b>, <b>/canto</b>, <b>/stickers</b>, <b>/bolos</b>, <b>/futuro</b>, <b>/misterio</b> o <b>/cloe</b>.");

    }, 1000 + Math.random() * 400); // Peque√±a variaci√≥n para que parezca m√°s natural
  }

  /* ============================================
     RENDERIZAR CHIPS DE COMANDOS
     Cambia seg√∫n si el juego est√° completado o no
     ============================================ */
  function renderChips() {
    panelChips.innerHTML = "";

    // Comandos siempre libres
    const libres = [
      {label:"/chiste", cmd:"/chiste"},
      {label:"/frase", cmd:"/frase"},
      {label:"/canto üé§", cmd:"/canto"},
      {label:"/stickers", cmd:"/stickers"},
      {label:"/bolos üé≥", cmd:"/bolos"},
      {label:"/cloe üê∫", cmd:"/cloe"},
      {label:"/misterio üåë", cmd:"/misterio"},
      {label:"/futuro üîí", cmd:"/futuro"},
    ];
    libres.forEach(({label, cmd}) => {
      const c = document.createElement("button");
      c.className = "chip";
      c.textContent = label;
      c.onclick = () => enviarComando(cmd);
      panelChips.appendChild(c);
    });

    // Jugar (solo si no ha terminado)
    if (!juegoCompletado) {
      const c = document.createElement("button");
      c.className = "chip";
      c.textContent = "/jugar üéÆ";
      c.onclick = () => enviarComando("/jugar");
      panelChips.appendChild(c);
    }

    // /foto y /regalo: con o sin candado seg√∫n estado
    [{label:"/foto üì∏", cmd:"/foto"}, {label:"/regalo üéÅ", cmd:"/regalo"}].forEach(({label, cmd}) => {
      const c = document.createElement("button");
      c.className = juegoCompletado ? "chip" : "chip locked";
      c.textContent = label;
      c.onclick = () => enviarComando(cmd);
      panelChips.appendChild(c);
    });
  }

  /* ============================================
     HELPERS: enviar mensajes
     ============================================ */

  // Mensaje del bot con timestamp
  function enviarBot(html) {
    const d = document.createElement('div');
    d.className = 'mensaje bot';
    d.innerHTML = html + `<span class="hora">${horaActual()}</span>`;
    chat.appendChild(d);
    chat.scrollTop = chat.scrollHeight;
  }

  // Mensaje del usuario con timestamp
  function enviarUsuario(texto) {
    const d = document.createElement('div');
    d.className = 'mensaje usuario';
    d.innerText = texto;
    d.innerHTML += `<span class="hora">${horaActual()} ‚úì‚úì</span>`;
    chat.appendChild(d);
    chat.scrollTop = chat.scrollHeight;
  }

  // Mensaje de error + efecto shake
  function errorBot(msg) {
    enviarBot(msg);
    chat.classList.add('shake');
    setTimeout(() => chat.classList.remove('shake'), 350);
  }

  // Mensaje del bot con retraso inicial (para la bienvenida)
  function botDelayed(msg, delay) {
    setTimeout(() => {
      document.getElementById('dots').classList.add('visible');
      setTimeout(() => {
        document.getElementById('dots').classList.remove('visible');
        enviarBot(msg);
      }, 800);
    }, delay);
  }

  /* ============================================
     HELPERS VARIOS
     ============================================ */

  // Devuelve un elemento aleatorio de un array
  function aleatorio(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // Devuelve la hora actual en formato HH:MM
  function horaActual() {
    return new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
  }

  /* ============================================
     CONTADOR DE CUMPLEA√ëOS
     Muestra tiempo restante hasta medianoche de hoy
     o hasta el pr√≥ximo cumplea√±os (28 de febrero)
     ============================================ */
  // Cuenta atr√°s fija hacia el 28 de febrero de 2027 (pr√≥ximo cumple de Cloe)
  const OBJETIVO_FUTURO = new Date(2027, 1, 28, 0, 0, 0); // 28-feb-2027 medianoche

  function calcularContador() {
    const ahora = new Date();
    const diff  = OBJETIVO_FUTURO - ahora;
    if (diff <= 0) return { dias: 0, h: 0, m: 0, s: 0 };
    const dias = Math.floor(diff / 86_400_000);
    const h    = Math.floor((diff % 86_400_000) / 3_600_000);
    const m    = Math.floor((diff % 3_600_000) / 60_000);
    const s    = Math.floor((diff % 60_000) / 1_000);
    return { dias, h, m, s };
  }

  function pad(n) { return String(n).padStart(2, '0'); }

  // Genera el HTML del contador como burbuja de chat (snapshot, no live)
  function generarContadorHTML() {
    const c = calcularContador();
    return `
      <div style="margin-bottom:6px;font-size:0.75rem;color:var(--rosa);font-weight:600">üîí Cuenta atr√°s ‚Äî 28 feb 2027</div>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="contador-bloque"><div class="contador-valor">${c.dias}</div><div class="contador-label">d√≠as</div></div>
        <div class="contador-sep">:</div>
        <div class="contador-bloque"><div class="contador-valor">${pad(c.h)}</div><div class="contador-label">h</div></div>
        <div class="contador-sep">:</div>
        <div class="contador-bloque"><div class="contador-valor">${pad(c.m)}</div><div class="contador-label">min</div></div>
        <div class="contador-sep">:</div>
        <div class="contador-bloque"><div class="contador-valor">${pad(c.s)}</div><div class="contador-label">seg</div></div>
      </div>
      <div style="font-size:0.65rem;color:#555;margin-top:8px">Para saber m√°s‚Ä¶ tendr√°s que esperar. üåë</div>`;
  }

  /* ============================================
     PANTALLA FINAL CON CONFETTI
     ============================================ */
  function mostrarPantallaFinal() {
    document.getElementById('app').style.display = 'none';
    const pf = document.getElementById('pantalla-final');
    pf.style.display = 'flex';

    // Confetti durante 15 segundos
    const end = Date.now() + 15_000;
    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 1001 };

    const interval = setInterval(() => {
      const timeLeft = end - Date.now();
      if (timeLeft <= 0) return clearInterval(interval);

      const count = 50 * (timeLeft / 15_000);
      confetti({ ...defaults, particleCount: count, origin: { x: Math.random() * 0.4,       y: Math.random() - 0.2 } });
      confetti({ ...defaults, particleCount: count, origin: { x: 0.6 + Math.random() * 0.4, y: Math.random() - 0.2 } });
    }, 250);
  }
</script>
</body>
</html>
